{% comment %}
  Featured products section for GetSupp-style homepage
{% endcomment %}

<script src="{{ 'product-form.js' | asset_url }}" defer="defer"></script>

<div class="featured-products">
  <div class="container">
    {% if section.settings.heading != blank %}
      <h2 class="featured-products__heading">{{ section.settings.heading }}</h2>
    {% endif %}

    {% if section.settings.collection != blank %}
      <div class="featured-products__grid">
        {% for product in section.settings.collection.products limit: section.settings.products_to_show %}
          <div class="featured-products__item">
            <div class="featured-products__image">
              {% if product.featured_image %}
                {% render 'image', image: product.featured_image, alt: product.title %}
              {% else %}
                <div class="featured-products__placeholder">
                  <!-- placeholder svg -->
                  <svg width="60" height="60" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <rect x="3" y="3" width="18" height="18" rx="2" stroke="currentColor" stroke-width="2" />
                    <circle cx="8.5" cy="8.5" r="1.5" stroke="currentColor" stroke-width="2" />
                    <path d="M21 15L16 10L5 21" stroke="currentColor" stroke-width="2" />
                  </svg>
                </div>
              {% endif %}

              {% if product.compare_at_price > product.price %}
                <div class="featured-products__badge">Sale</div>
              {% endif %}
            </div>

            <div class="featured-products__content">
              <div class="featured-products__main-content">
                {%- comment -%} Category pill above rating {%- endcomment -%}
                {%- if product.type != blank -%}
                  <div class="card__category"><span class="card__category-tag">{{ product.type }}</span></div>
                {%- else -%}
                  {%- assign _category_label = '' -%}
                  {%- for t in product.tags -%}
                    {%- assign t_down = t | downcase -%}
                    {%- if t_down == 'ayurvedic' or t_down == 'organic' or t_down == 'herbal' or t_down == 'ayurveda' -%}
                      {%- assign _category_label = t | capitalize -%}
                      {%- break -%}
                    {%- endif -%}
                  {%- endfor -%}
                  {%- if _category_label == '' and product.tags.size > 0 -%}
                    {%- assign _category_label = product.tags.first | capitalize -%}
                  {%- endif -%}
                  {%- if _category_label != '' -%}
                    <div class="card__category"><span class="card__category-tag">{{ _category_label }}</span></div>
                  {%- endif -%}
                {%- endif -%}

                <!-- Rating -->
                <div class="featured-products__rating-prominent">
                  <div class="featured-products__stars-large">
                    <span class="featured-products__star-large">★</span>
                    <span class="featured-products__star-large">★</span>
                    <span class="featured-products__star-large">★</span>
                    <span class="featured-products__star-large">★</span>
                    <span class="featured-products__star-large">★</span>
                  </div>
                  <div class="featured-products__rating-details">
                    <span class="featured-products__rating-score">4.8</span>
                    <span class="featured-products__review-count-prominent">({{ 200 | plus: forloop.index | times: 4 }} reviews)</span>
                  </div>
                </div>

                <h3 class="featured-products__title"><a href="{{ product.url }}">{{ product.title }}</a></h3>

                <div class="featured-products__price">
                  {% if product.compare_at_price > product.price %}
                    {% assign discount_amount = product.compare_at_price | minus: product.price %}
                    {% assign discount_percentage = discount_amount | times: 100 | divided_by: product.compare_at_price %}
                    <div class="featured-products__price-with-discount">
                      <div class="featured-products__discount-badges">
                        <span class="featured-products__discount-percentage">-{{ discount_percentage }}%</span>
                        <span class="featured-products__discount-savings">Save {{ discount_amount | money }}</span>
                      </div>
                      <div class="featured-products__price-comparison">
                        <span class="featured-products__price--compare">{{ product.compare_at_price | money }}</span>
                        <span class="featured-products__price--sale">{{ product.price | money }}</span>
                      </div>
                    </div>
                  {% else %}
                    <div class="featured-products__price-regular">
                      <span class="featured-products__price--regular">{{ product.price | money }}</span>
                    </div>
                  {% endif %}
                </div>
              </div>

              <div class="featured-products__actions">
                <product-form data-section-id="{{ section.id }}" data-show-notification="true">
                  <form action="/cart/add" method="post" enctype="multipart/form-data" data-type="add-to-cart-form">
                    <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}" class="product-variant-id">
                    <button type="submit" class="featured-products__button" name="add">Add to Cart {%- render 'loading-spinner' -%}</button>
                  </form>
                </product-form>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
      {% if section.settings.show_view_all %}
        <div class="featured-products__footer">
          <a href="{{ section.settings.collection.url }}" class="featured-products__view-all">View All Products
            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6 12L10 8L6 4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" /></svg>
          </a>
        </div>
      {% endif %}
    {% endif %}
  </div>
</div>

{% stylesheet %}
  .featured-products {
    padding: 4rem 0;
    background-color: white;
  }

  .container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 1rem;
  }

  .featured-products__heading {
    text-align: center;
    font-size: 2.5rem;
    font-weight: bold;
    color: #333;
    margin-bottom: 3rem;
  }

  .featured-products__grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 2rem;
    margin-bottom: 3rem;
  }

  .featured-products__item {
    background: white;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    border: 1px solid #e9ecef;
    display: flex;
    flex-direction: column;
    height: 100%;
    min-height: 500px; /* Ensure consistent minimum height */
  }

  .featured-products__item:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
  }

  .featured-products__image {
    position: relative;
    height: 200px;
    overflow: hidden;
  }

  .featured-products__image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .featured-products__placeholder {
    display: flex;
    align-items: center;
    justify-content: center;
    height: 100%;
    color: #ccc;
  }

  .featured-products__badge {
    position: absolute;
    top: 0.5rem;
    right: 0.5rem;
    background-color: #dc3545;
    color: white;
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    font-size: 0.75rem;
    font-weight: bold;
  }

  .featured-products__content {
    padding: 1.5rem;
    display: flex;
    flex-direction: column;
    flex-grow: 1;
    justify-content: space-between;
  }

  .featured-products__main-content {
    flex-grow: 1;
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .featured-products__actions {
    margin-top: auto;
    padding-top: 1rem;
  }

  .featured-products__title {
    margin-bottom: 0.5rem;
  }

  .featured-products__title a {
    color: #333;
    text-decoration: none;
    font-size: 1.1rem;
    font-weight: 500;
  }

  .featured-products__title a:hover {
    color: #24BAAD;
  }

  /* Enhanced Pricing Display Styles for Featured Products */
  .featured-products__price {
    margin-bottom: 1rem;
  }

  .featured-products__price-with-discount {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .featured-products__discount-badges {
    display: flex;
    gap: 6px;
    align-items: center;
    flex-wrap: wrap;
  }

  .featured-products__discount-percentage {
    background: linear-gradient(135deg, #e53e3e 0%, #c53030 100%);
    color: white;
    padding: 4px 8px;
    border-radius: 12px;
    font-size: 12px;
    font-weight: 700;
    box-shadow: 0 2px 4px rgba(229, 62, 62, 0.3);
    text-shadow: 0 1px 1px rgba(0, 0, 0, 0.2);
    transition: all 0.3s ease;
  }

  .featured-products__item:hover .featured-products__discount-percentage {
    background: linear-gradient(135deg, #c53030 0%, #9c2929 100%);
    box-shadow: 0 3px 6px rgba(229, 62, 62, 0.4);
    transform: scale(1.05);
  }

  .featured-products__discount-savings {
    background: linear-gradient(135deg, #38a169 0%, #2f855a 100%);
    color: white;
    padding: 4px 8px;
    border-radius: 12px;
    font-size: 11px;
    font-weight: 600;
    box-shadow: 0 2px 4px rgba(56, 161, 105, 0.3);
    text-shadow: 0 1px 1px rgba(0, 0, 0, 0.2);
    transition: all 0.3s ease;
  }

  .featured-products__item:hover .featured-products__discount-savings {
    background: linear-gradient(135deg, #2f855a 0%, #276749 100%);
    box-shadow: 0 3px 6px rgba(56, 161, 105, 0.4);
    transform: scale(1.05);
  }

  .featured-products__price-comparison {
    display: flex;
    align-items: center;
    gap: 12px;
    flex-wrap: wrap;
  }

  .featured-products__price--compare {
    color: #999;
    text-decoration: line-through;
    margin-left: 0;
    font-weight: 500;
    position: relative;
  }

  .featured-products__price--compare::before {
    content: '';
    position: absolute;
    top: 50%;
    left: -2px;
    right: -2px;
    height: 2px;
    background: #e53e3e;
    transform: translateY(-50%);
    opacity: 0.8;
  }

  .featured-products__price--sale {
    color: #04683F;
    font-weight: bold;
    font-size: 1.2rem;
    text-shadow: 0 1px 2px rgba(4, 104, 63, 0.1);
  }

  .featured-products__price-regular .featured-products__price--regular {
    color: #333;
    font-weight: bold;
    font-size: 1.1rem;
  }

  /* Enhanced Prominent Rating Styles for Featured Products */
  .featured-products__rating-prominent {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    gap: 6px;
    margin-bottom: 16px;
    padding: 12px 0;
    transition: all 0.3s ease;
    position: relative;
  }

  .featured-products__item:hover .featured-products__rating-prominent {
    transform: translateY(-2px);
  }

  .featured-products__stars-large {
    display: flex;
    gap: 3px;
    margin-bottom: 4px;
  }

  .featured-products__star-large {
    color: #ffc107;
    font-size: 18px;
    text-shadow: 0 1px 2px rgba(255, 193, 7, 0.3);
    filter: drop-shadow(0 1px 1px rgba(0, 0, 0, 0.1));
    transition: transform 0.2s ease;
  }

  .featured-products__item:hover .featured-products__star-large {
    transform: scale(1.1);
  }

  .featured-products__rating-details {
    display: flex;
    align-items: center;
    gap: 8px;
    flex-wrap: wrap;
  }

  .featured-products__rating-score {
    font-size: 16px;
    font-weight: 700;
    color: #f57c00;
    background: white;
    padding: 2px 8px;
    border-radius: 12px;
    border: 1px solid #e0e0e0;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    transition: all 0.3s ease;
  }

  .featured-products__item:hover .featured-products__rating-score {
    background: #f5f5f5;
    transform: scale(1.05);
  }

  .featured-products__review-count-prominent {
    font-size: 13px;
    color: #5d4037;
    font-weight: 600;
    background: rgba(245, 245, 245, 0.8);
    padding: 2px 6px;
    border-radius: 8px;
    transition: all 0.3s ease;
  }

  .featured-products__item:hover .featured-products__review-count-prominent {
    background: rgba(245, 245, 245, 0.95);
    color: #4e342e;
  }

  /* Legacy rating styles - kept for backwards compatibility */
  .featured-products__rating {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 1rem;
  }

  .featured-products__stars {
    color: #ffc107;
    font-size: 0.9rem;
  }

  .featured-products__reviews {
    color: #666;
    font-size: 0.9rem;
  }

  .featured-products__button {
    width: 100%;
    background-color: #24BAAD;
    color: white;
    border: none;
    padding: 0.75rem 1rem;
    border-radius: 6px;
    font-weight: 500;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }

  .featured-products__button:hover {
    background-color: #1a9b8f;
  }

  .featured-products__footer {
    text-align: center;
  }

  .featured-products__view-all {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    color: #24BAAD;
    text-decoration: none;
    font-weight: 500;
    font-size: 1.1rem;
    padding: 1rem 2rem;
    border: 2px solid #24BAAD;
    border-radius: 50px;
    transition: all 0.3s ease;
  }

  .featured-products__view-all:hover {
    background-color: #24BAAD;
    color: white;
  }

  .featured-products__view-all svg {
    transition: transform 0.3s ease;
  }

  .featured-products__view-all:hover svg {
    transform: translateX(4px);
  }

  @media (max-width: 768px) {
    .featured-products {
      padding: 2rem 0;
    }

    .featured-products__heading {
      font-size: 2rem;
      margin-bottom: 2rem;
    }

    .featured-products__grid {
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1.5rem;
    }

    /* Mobile responsive for enhanced ratings */
    .featured-products__rating-prominent {
      padding: 10px 0;
      margin-bottom: 14px;
    }

    .featured-products__star-large {
      font-size: 16px;
    }

    .featured-products__rating-score {
      font-size: 14px;
      padding: 2px 6px;
    }

    .featured-products__review-count-prominent {
      font-size: 12px;
    }

    /* Mobile responsive for enhanced pricing */
    .featured-products__discount-percentage {
      font-size: 11px;
      padding: 3px 6px;
    }

    .featured-products__discount-savings {
      font-size: 10px;
      padding: 3px 6px;
    }

    .featured-products__price-comparison {
      gap: 8px;
    }

    .featured-products__price--sale {
      font-size: 1.1rem;
    }
  }

  @media (max-width: 480px) {
    .featured-products__rating-prominent {
      padding: 8px 0;
      margin-bottom: 12px;
    }

    .featured-products__stars-large {
      gap: 2px;
    }

    .featured-products__star-large {
      font-size: 15px;
    }

    .featured-products__rating-details {
      gap: 6px;
    }

    .featured-products__rating-score {
      font-size: 13px;
      padding: 1px 5px;
    }

    .featured-products__review-count-prominent {
      font-size: 11px;
    }

    /* Enhanced mobile pricing styles */
    .featured-products__discount-badges {
      gap: 4px;
    }

    .featured-products__discount-percentage {
      font-size: 10px;
      padding: 2px 5px;
    }

    .featured-products__discount-savings {
      font-size: 9px;
      padding: 2px 5px;
    }

    .featured-products__price--sale {
      font-size: 1rem;
    }

    .featured-products__price-comparison {
      gap: 6px;
    }
  }

  @media (max-width: 480px) {
    .featured-products__rating-prominent {
      padding: 8px 0;
      margin-bottom: 12px;
    }

    .featured-products__stars-large {
      gap: 2px;
    }

    .featured-products__star-large {
      font-size: 15px;
    }

    .featured-products__rating-details {
      gap: 6px;
    }

    .featured-products__rating-score {
      font-size: 13px;
      padding: 1px 5px;
    }

    .featured-products__review-count-prominent {
      font-size: 11px;
    }
  }
{% endstylesheet %}

{% schema %}
  {
    "name": "Featured Products",
    "settings": [
      {
        "type": "text",
        "id": "heading",
        "label": "Heading",
        "default": "Featured Products"
      }, {
        "type": "collection",
        "id": "collection",
        "label": "Collection"
      }, {
        "type": "range",
        "id": "products_to_show",
        "label": "Products to show",
        "min": 2,
        "max": 12,
        "step": 1,
        "default": 8
      }, {
        "type": "checkbox",
        "id": "show_view_all",
        "label": "Show 'View All' button",
        "default": true
      }
    ],
    "presets": [
      {
        "name": "Featured Products",
        "category": "Homepage"
      }
    ]
  }
{% endschema %}